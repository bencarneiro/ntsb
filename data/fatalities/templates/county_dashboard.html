<!DOCTYPE html>
<html>
    <style>
        h1 {text-align: center;}
        h2 {text-align: center;}
        h3 {text-align: center;}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.7.2/dist/axios.min.js"></script>
    <script>

        async function get_data() {
                await axios.get("/total_fatalities?county_id={{ county.id }}").then((response)=>{
                    console.log(response.data)
                    console.log(response.data.labels)
                    console.log(response.data.total_fatalities);
                    const TOTAL_FATALITIES = response.data.total;
                    const TOTAL_AVG = response.data.total_average;
                    const VEHICLE_FATALITIES = response.data.vehicle_fatalities;
                    const V_AVG = response.data.vehicle_fatalities_average
                    const PEDESTRIAN_FATALITIES = response.data.pedestrian_fatalities;
                    const P_AVG = response.data.pedestrian_fatalities_average
                    const NONMOTORIST_FATALITIES = response.data.nonmotorist_fatalities;
                    const N_AVG = response.data.nonmotorist_fatalities_average
                    const BICYCLE_FATALITIES = response.data.bicycle_fatalities;
                    const B_AVG = response.data.bicycle_fatalities_average
                    const LABELS = response.data.labels;
                    const FUNCTIONAL_SYSTEM = response.data.functional_system_data
                    const TOTAL_LANES = response.data.total_lanes_data
                
                    new Chart(document.getElementById("total-fatalities"), {
                        type: "bar",
                        data: {
                            labels: LABELS,
                            datasets: [
                            {
                                data: TOTAL_FATALITIES,
                                label: "Annual Roadway Deaths",
                                borderColor: "#3e95cd",
                                fill: false
                            },
                            {
                                type: "line",
                                label: "3-Year Moving Average",
                                data: TOTAL_AVG,
                                borderColor: "#3e95cd",
                                fill: false
                            }
                            ]
                        },
                        options: {
                            title: {
                            display: true,
                            responsive: true,
                            text: "Annual Roadway Deaths in {{ county.name }} County"
                            },
                            scales: {
                            y: {
                                min: 0
                            }
                            }
                        }
                        });
                    new Chart(document.getElementById("vehicles"), {
                        type: "bar",
                        data: {
                            labels: LABELS,
                            datasets: [
                            {
                                data: VEHICLE_FATALITIES,
                                label: "Annual Driver / Passenger Roadway Deaths",
                                borderColor: "#8e5ea2",
                                fill: false
                            },
                            {
                                type: "line",
                                label: "3-Year Moving Average",
                                data: V_AVG,
                                borderColor: "#3e95cd",
                                fill: false
                            }
                            ]
                        },
                        options: {
                            title: {
                            display: true,
                            responsive: true,
                            text: "Types of Roadway Deaths in {{ county.name }} County"
                            },
                            scales: {
                            y: {
                                min: 0
                            }
                            }
                        }
                        });
                    new Chart(document.getElementById("nonmotorists"), {
                        type: "bar",
                        data: {
                            labels: LABELS,
                            datasets: [
                            {
                                data: NONMOTORIST_FATALITIES,
                                label: "Annual Nonmotorist Deaths",
                                borderColor: "#8e5ea2",
                                fill: false
                            },
                            {
                                type: "line",
                                label: "3-Year Moving Average",
                                data: N_AVG,
                                borderColor: "#3e95cd",
                                fill: false
                            }
                            ]
                        },
                        options: {
                            title: {
                            display: true,
                            responsive: true,
                            text: "Types of Roadway Deaths in {{ county.name }} County"
                            },
                            scales: {
                            y: {
                                min: 0
                            }
                            }
                        }
                        });
                    new Chart(document.getElementById("pedestrians"), {
                        type: "bar",
                        data: {
                            labels: LABELS,
                            datasets: [
                            {
                                data: PEDESTRIAN_FATALITIES,
                                label: "Annual Pedestrian Roadway Deaths",
                                borderColor: "#8e5ea2",
                                fill: false
                            },
                            {
                                type: "line",
                                label: "3-Year Moving Average",
                                data: P_AVG,
                                borderColor: "#3e95cd",
                                fill: false
                            }
                            ]
                        },
                        options: {
                            title: {
                            display: true,
                            responsive: true,
                            text: "Types of Roadway Deaths in {{ county.name }} County"
                            },
                            scales: {
                            y: {
                                min: 0
                            }
                            }
                        }
                        });
                    new Chart(document.getElementById("bikes"), {
                        type: "bar",
                        data: {
                            labels: LABELS,
                            datasets: [
                            {
                                data: BICYCLE_FATALITIES,
                                label: "Annual Bicycle / Micro-mobility Roadway Deaths",
                                borderColor: "#3e95cd",
                                fill: false
                            },
                            {
                                type: "line",
                                label: "3-Year Moving Average",
                                data: B_AVG,
                                borderColor: "#3e95cd",
                                fill: false
                            }
                            ]
                        },
                        options: {
                            title: {
                            display: true,
                            responsive: true,
                            text: "Types of Roadway Deaths in {{ county.name }} County"
                            },
                            scales: {
                            y: {
                                min: 0
                            }
                            }
                        }
                        });

                    new Chart(document.getElementById("functional_system"), {
                        type: "bar",
                        data: {
                            labels: LABELS,
                            datasets: [
                                {
                                    label: 'Interstate',
                                    data: FUNCTIONAL_SYSTEM,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '1'
                                    }
                                },
                                {
                                    label: 'Principal Arterial - Other Freeways and Expressways',
                                    data: FUNCTIONAL_SYSTEM,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '2'
                                    }
                                },
                                {
                                    label: 'Principal Arterial - Other',
                                    data: FUNCTIONAL_SYSTEM,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '3'
                                    }
                                },
                                {
                                    label: 'Minor Arterial',
                                    data: FUNCTIONAL_SYSTEM,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '5'
                                    }
                                },
                                {
                                    label: "Major Collector",
                                    data: FUNCTIONAL_SYSTEM,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '5'
                                    }
                                },
                                {
                                    label: 'Minor Collector',
                                    data: FUNCTIONAL_SYSTEM,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '6'
                                    }
                                },
                                {
                                    label: 'Local',
                                    data: FUNCTIONAL_SYSTEM,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '7'
                                    }
                                },
                                {
                                    label: 'Unknown',
                                    data: FUNCTIONAL_SYSTEM,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '99'
                                    }
                                },
                            ]
                        },

                        }
                        );

                    new Chart(document.getElementById("total_lanes"), {
                        type: "bar",
                        data: {
                            labels: LABELS,
                            datasets: [
                                {
                                    label: 'One Lane',
                                    data: TOTAL_LANES,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '1'
                                    }
                                },
                                {
                                    label: 'Two Lanes',
                                    data: TOTAL_LANES,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '2'
                                    }
                                },
                                {
                                    label: 'Three Lanes',
                                    data: TOTAL_LANES,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '3'
                                    }
                                },
                                {
                                    label: 'Four Lanes',
                                    data: TOTAL_LANES,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '4'
                                    }
                                },
                                {
                                    label: 'Five Lanes',
                                    data: TOTAL_LANES,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '5'
                                    }
                                },
                                {
                                    label: 'Six Lanes',
                                    data: TOTAL_LANES,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '6'
                                    }
                                },
                                {
                                    label: 'Seven or More Lanes',
                                    data: TOTAL_LANES,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '7'
                                    }
                                },
                                {
                                    label: 'Not Reported',
                                    data: TOTAL_LANES,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '8'
                                    }
                                },
                                {
                                    label: 'Unknown',
                                    data: TOTAL_LANES,
                                    // borderColor: "#3e95cd",
                                    parsing: {
                                        yAxisKey: '9'
                                    }
                                },
                            ]
                        },

                        }
                        );
                }
            )
        }
        
    </script>
  <head>
    <title>{{county.name}} County Dashboard</title>
    <meta charset="UTF-8" />
  </head>

  <body>
    <h1>
        {{county.name}} County Dashboard
    </h1>
    <h3><a href="/county_selector">See Other Counties</a></h3>
    <h2>Total Roadway Deaths</h2>
    <canvas id="total-fatalities" width="800" height="300"></canvas>
    <h2>Driver / Passenger Roadway Deaths</h2>
    <canvas id="vehicles" width="800" height="300"></canvas>
    <h2>Non-Motorist Roadway Deaths</h2>
    <canvas id="nonmotorists" width="800" height="300"></canvas>
    <h2>Pedestrian Deaths</h2>
    <canvas id="pedestrians" width="800" height="300"></canvas>
    <h2>Bicycle / Micro-Mobility Deaths</h2>
    <canvas id="bikes" width="800" height="300"></canvas>
    <h2>Functional System</h2>
    <canvas id="functional_system" width="800" height="300"></canvas>
    <h2>Nonmotorist Deaths by Total Lanes in Roadway</h2>
    <canvas id="total_lanes" width="800" height="300"></canvas>



    <script> 
        
        get_data()
        </script>
  </body>
</html>
